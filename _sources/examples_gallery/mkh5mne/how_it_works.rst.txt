
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "examples_gallery/mkh5mne/how_it_works.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_examples_gallery_mkh5mne_how_it_works.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_examples_gallery_mkh5mne_how_it_works.py:


How it works
############

.. GENERATED FROM PYTHON SOURCE LINES 7-22

The sample mkh5 file is for a single subject in an auditory oddball paradigm with
some epochs tables previously marked.

Converting mkh5 HDF5 to MNE RawMkh5 does several things:

* concatenates the separate mkh5 datablock EEG and event data channels into one long mne.Raw strip chart

* populates the mne.Info structure with header info including
  electrode names and locations

* extracts all the mkpy epochs tables from the HDF5 and packs them into the mne.Info

* for each epoch table, a new "stim" event code channel is created in the mne.Raw with
  the name of the epochs table and all and only the events from that table.


.. GENERATED FROM PYTHON SOURCE LINES 25-26

FYI ... environment and versions.

.. GENERATED FROM PYTHON SOURCE LINES 26-37

.. code-block:: default

    import os
    import mne
    import mkpy
    from mkpy.io import mkh5mne

    mne.viz.set_browser_backend("matplotlib")  # for docs generation

    print("conda env", os.environ["CONDA_DEFAULT_ENV"])
    for pkg in [mkpy, mne]:
        print(pkg.__name__, pkg.__version__)





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    conda env env_3.8
    mkpy 0.2.7
    mne 1.0.3




.. GENERATED FROM PYTHON SOURCE LINES 38-41

Convert the EEG and event-tagged epochs. Electrode locations are
required, they can be included in the YAML .yhdr when the mkh5 file
is created or added during conversion as shown.

.. GENERATED FROM PYTHON SOURCE LINES 41-44

.. code-block:: default

    p3_h5_f = "../mkh5_data/sub000p3.h5"
    mne_raw = mkh5mne.from_mkh5(p3_h5_f, apparatus_yaml="mne_32chan_xyz_spherical.yml")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    ../mkh5_data/sub000p3.h5
    looking up data block paths, larger files take longer ...
    ok
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_0 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    checking info, montage sub000/dblock_1
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_1 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    checking info, montage sub000/dblock_2
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_2 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    checking info, montage sub000/dblock_3
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_3 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    checking info, montage sub000/dblock_4
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_4 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_0 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    Creating RawArray with float64 data, n_channels=39, n_times=31232
        Range : 0 ... 31231 =      0.000 ...   124.924 secs
    Ready.
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1478: RuntimeWarning: Not setting position of 1 eog channel found in montage:
    ['HEOG']
    Consider setting the channel types to be of EEG/sEEG/ECoG/DBS/fNIRS using inst.set_channel_types before calling inst.set_montage, or omit these channels when creating your montage.
      raw_dblock.set_montage(montage)
    sub000/dblock_0 setting mkh5 epochs table ms100 events and metadata
    sub000/dblock_0 setting mkh5 epochs table ms10000 events and metadata
    sub000/dblock_0 setting mkh5 epochs table ms1500 events and metadata
    sub000/dblock_0 setting mkh5 epochs table ms3000 events and metadata
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_1 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    Creating RawArray with float64 data, n_channels=39, n_times=32768
        Range : 0 ... 32767 =      0.000 ...   131.068 secs
    Ready.
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1478: RuntimeWarning: Not setting position of 1 eog channel found in montage:
    ['HEOG']
    Consider setting the channel types to be of EEG/sEEG/ECoG/DBS/fNIRS using inst.set_channel_types before calling inst.set_montage, or omit these channels when creating your montage.
      raw_dblock.set_montage(montage)
    sub000/dblock_1 setting mkh5 epochs table ms100 events and metadata
    sub000/dblock_1 setting mkh5 epochs table ms10000 events and metadata
    sub000/dblock_1 setting mkh5 epochs table ms1500 events and metadata
    sub000/dblock_1 setting mkh5 epochs table ms3000 events and metadata
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_2 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    Creating RawArray with float64 data, n_channels=39, n_times=31744
        Range : 0 ... 31743 =      0.000 ...   126.972 secs
    Ready.
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1478: RuntimeWarning: Not setting position of 1 eog channel found in montage:
    ['HEOG']
    Consider setting the channel types to be of EEG/sEEG/ECoG/DBS/fNIRS using inst.set_channel_types before calling inst.set_montage, or omit these channels when creating your montage.
      raw_dblock.set_montage(montage)
    sub000/dblock_2 setting mkh5 epochs table ms100 events and metadata
    sub000/dblock_2 setting mkh5 epochs table ms10000 events and metadata
    sub000/dblock_2 setting mkh5 epochs table ms1500 events and metadata
    sub000/dblock_2 setting mkh5 epochs table ms3000 events and metadata
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_3 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    Creating RawArray with float64 data, n_channels=39, n_times=32512
        Range : 0 ... 32511 =      0.000 ...   130.044 secs
    Ready.
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1478: RuntimeWarning: Not setting position of 1 eog channel found in montage:
    ['HEOG']
    Consider setting the channel types to be of EEG/sEEG/ECoG/DBS/fNIRS using inst.set_channel_types before calling inst.set_montage, or omit these channels when creating your montage.
      raw_dblock.set_montage(montage)
    sub000/dblock_3 setting mkh5 epochs table ms100 events and metadata
    sub000/dblock_3 setting mkh5 epochs table ms10000 events and metadata
    sub000/dblock_3 setting mkh5 epochs table ms1500 events and metadata
    sub000/dblock_3 setting mkh5 epochs table ms3000 events and metadata
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1190: UserWarning: Overriding /sub000/dblock_4 with sensor locations from mne_32chan_xyz_spherical.yml
      warnings.warn(msg)
    Creating RawArray with float64 data, n_channels=39, n_times=28416
        Range : 0 ... 28415 =      0.000 ...   113.660 secs
    Ready.
    /usr/share/miniconda/envs/env_3.8/lib/python3.8/site-packages/mkpy/io/mkh5mne.py:1478: RuntimeWarning: Not setting position of 1 eog channel found in montage:
    ['HEOG']
    Consider setting the channel types to be of EEG/sEEG/ECoG/DBS/fNIRS using inst.set_channel_types before calling inst.set_montage, or omit these channels when creating your montage.
      raw_dblock.set_montage(montage)
    sub000/dblock_4 setting mkh5 epochs table ms100 events and metadata
    sub000/dblock_4 setting mkh5 epochs table ms10000 events and metadata
    sub000/dblock_4 setting mkh5 epochs table ms1500 events and metadata
    sub000/dblock_4 setting mkh5 epochs table ms3000 events and metadata
    EEG data marked as already having the desired reference.




.. GENERATED FROM PYTHON SOURCE LINES 45-47

When the mkh5 datablocks are knit together for MNE, the discontinuities at edges
are tracked automatically as mne.Annotations

.. GENERATED FROM PYTHON SOURCE LINES 47-49

.. code-block:: default

    mne_raw.annotations.description





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    array(['sub000/dblock_0', 'sub000/dblock_1', 'BAD boundary',
           'EDGE boundary', 'sub000/dblock_2', 'BAD boundary',
           'EDGE boundary', 'sub000/dblock_3', 'BAD boundary',
           'EDGE boundary', 'sub000/dblock_4', 'BAD boundary',
           'EDGE boundary'], dtype='<U15')



.. GENERATED FROM PYTHON SOURCE LINES 50-52

The mne_raw object has the mne.Info attached. You can see the mkh5 epoch_table info
peeking out of the mne.Info["description"] field.

.. GENERATED FROM PYTHON SOURCE LINES 52-54

.. code-block:: default

    mne_raw.info






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <table class="table table-hover table-striped table-sm table-responsive small">
        <tr>
            <th>Measurement date</th>
        
            <td>July 25, 2020  14:23:44 GMT</td>
        
        </tr>
        <tr>
            <th>Experimenter</th>
        
            <td>Unknown</td>
        
        </tr>
            <th>Participant</th>
        
            
                <td>33f90cab-395e-4871-8641-3be5c9e9d579</td>
            
        
        </tr>
        <tr>
            <th>Digitized points</th>
        
            <td>0 points</td>
        
        </tr>
        <tr>
            <th>Good channels</th>
            <td>2 misc, 9 Stimulus, 31 EEG, 1 EOG</td>
        </tr>
        <tr>
            <th>Bad channels</th>
            <td>None</td>
        </tr>
        <tr>
            <th>EOG channels</th>
            <td>HEOG</td>
        </tr>
        <tr>
            <th>ECG channels</th>
            <td>Not available</td>
    
        <tr>
            <th>Sampling frequency</th>
            <td>250.00 Hz</td>
        </tr>
    
    
        <tr>
            <th>Highpass</th>
            <td>0.00 Hz</td>
        </tr>
    
    
        <tr>
            <th>Lowpass</th>
            <td>125.00 Hz</td>
        </tr>
    
    
    </table>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 55-58

This RawMkh5 object can do all the usual mne.Raw tricks like plotting and writing
itself to an MNE raw `.fif` file.
%%

.. GENERATED FROM PYTHON SOURCE LINES 58-66

.. code-block:: default

    p3_events = mkh5mne.find_mkh5_events(mne_raw, "ms1500")
    _ = mne_raw.plot(
        p3_events,
        start=53.0,
        duration=3.0,
    )
    _ = mne.viz.plot_sensors(mne_raw.info)




.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /examples_gallery/mkh5mne/images/sphx_glr_how_it_works_001.png
         :alt: how it works
         :srcset: /examples_gallery/mkh5mne/images/sphx_glr_how_it_works_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /examples_gallery/mkh5mne/images/sphx_glr_how_it_works_002.png
         :alt: how it works
         :srcset: /examples_gallery/mkh5mne/images/sphx_glr_how_it_works_002.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Opening raw-browser...




.. GENERATED FROM PYTHON SOURCE LINES 67-73

Annotate garv artifacts (optional)
----------------------------------

The mkh5 log_flags that indicate garv artifact events after ``avg
-x`` can be converted to `BAD_garv` mne.Annotations for events on
any of the event channels.

.. GENERATED FROM PYTHON SOURCE LINES 73-82

.. code-block:: default


    # Select the event channel to annotate ("log_evcodes" for all), then
    # then add the annotations to the mne.Raw
    garv_bads = mkh5mne.get_garv_bads(
        mne_raw, event_channel="ms1500", tmin=-750, tmax=750, units="ms"
    )
    mne_raw.set_annotations(mne_raw.annotations + garv_bads)
    mne_raw.annotations





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    <Annotations | 71 segments: BAD boundary (4), BAD_garv_32 (33), ...>



.. GENERATED FROM PYTHON SOURCE LINES 83-89

mne.Epochs codemap metadata
---------------------------

Use :py:meth:.`get_epochs_metadata` to extract mne.Epochs with
the codemap metatdata
as MNE format metata when constructing mne.Epochs.

.. GENERATED FROM PYTHON SOURCE LINES 89-98

.. code-block:: default

    mne_epochs = mkh5mne.get_epochs(
        mne_raw,
        "ms1500",
        preload=True,  # populate the Epochs with data and apply projections
        reject_by_annotation=True,  # drop the BAD_* annotations or set False to keep them
        baseline=(-0.2, 0.0),  # center on this interval
    )
    mne_epochs





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    Adding metadata with 40 columns
    600 matching events found
    Applying baseline correction (mode: mean)
    0 projection items activated
    Using data from preloaded Raw for 600 events and 376 original time points ...
    131 bad epochs dropped


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <table class="table table-hover table-striped table-sm table-responsive small">
        <tr>
            <th>Number of events</th>
            <td>469</td>
        </tr>
        <tr>
            <th>Events</th>
        
            <td>1: 49<br/>10: 100<br/>11: 22<br/>2: 47<br/>20: 116<br/>21: 23<br/>3: 56<br/>4: 56</td>
        
        </tr>
        <tr>
            <th>Time range</th>
            <td>-0.748 – 0.752 sec</td>
        </tr>
        <tr>
            <th>Baseline</th>
            <td>-0.200 – 0.000 sec</td>
        </tr>
    </table>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 99-100

The mkh5 codemap tags are attached as native mne.Epochs.metadata

.. GENERATED FROM PYTHON SOURCE LINES 101-103

.. code-block:: default

    mne_epochs.metadata






.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>epoch_id</th>
          <th>data_group</th>
          <th>dblock_path</th>
          <th>dblock_tick_idx</th>
          <th>dblock_ticks</th>
          <th>crw_ticks</th>
          <th>raw_evcodes</th>
          <th>log_evcodes</th>
          <th>log_ccodes</th>
          <th>log_flags</th>
          <th>epoch_match_tick_delta</th>
          <th>epoch_ticks</th>
          <th>dblock_srate</th>
          <th>match_group</th>
          <th>idx</th>
          <th>dlim</th>
          <th>anchor_str</th>
          <th>match_str</th>
          <th>anchor_code</th>
          <th>match_code</th>
          <th>anchor_tick</th>
          <th>match_tick</th>
          <th>anchor_tick_delta</th>
          <th>is_anchor</th>
          <th>regexp</th>
          <th>ccode</th>
          <th>instrument</th>
          <th>bin</th>
          <th>tone</th>
          <th>stim</th>
          <th>accuracy</th>
          <th>acc_type</th>
          <th>match_time</th>
          <th>anchor_time</th>
          <th>anchor_time_delta</th>
          <th>diti_t_0</th>
          <th>diti_hop</th>
          <th>diti_len</th>
          <th>mne_dblock_path_idx</th>
          <th>mne_raw_tick</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>0</th>
          <td>27</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>0</td>
          <td>943</td>
          <td>943</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>0</td>
          <td>1</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>943</td>
          <td>943</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>943</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>943</td>
        </tr>
        <tr>
          <th>1</th>
          <td>28</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>1</td>
          <td>1212</td>
          <td>1212</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>1</td>
          <td>4</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>1212</td>
          <td>1212</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1212</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1212</td>
        </tr>
        <tr>
          <th>2</th>
          <td>0</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>2</td>
          <td>1468</td>
          <td>1468</td>
          <td>11</td>
          <td>11</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>2</td>
          <td>7</td>
          <td>11</td>
          <td>11</td>
          <td>11</td>
          <td>11</td>
          <td>1468</td>
          <td>1468</td>
          <td>0</td>
          <td>True</td>
          <td>(#11) 1040</td>
          <td>1</td>
          <td>eeg</td>
          <td>3</td>
          <td>hi</td>
          <td>target</td>
          <td>correct</td>
          <td>hit</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1468</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1468</td>
        </tr>
        <tr>
          <th>3</th>
          <td>29</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>4</td>
          <td>1814</td>
          <td>1814</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>4</td>
          <td>15</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>1814</td>
          <td>1814</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1814</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1814</td>
        </tr>
        <tr>
          <th>4</th>
          <td>30</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>5</td>
          <td>2066</td>
          <td>2066</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>5</td>
          <td>18</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>2066</td>
          <td>2066</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>2066</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>2066</td>
        </tr>
        <tr>
          <th>...</th>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
        </tr>
        <tr>
          <th>595</th>
          <td>596</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>204</td>
          <td>27315</td>
          <td>27315</td>
          <td>4</td>
          <td>4</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>204</td>
          <td>409</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>27315</td>
          <td>27315</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27315</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155571</td>
        </tr>
        <tr>
          <th>596</th>
          <td>597</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>205</td>
          <td>27444</td>
          <td>27444</td>
          <td>2</td>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>205</td>
          <td>411</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>27444</td>
          <td>27444</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27444</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155700</td>
        </tr>
        <tr>
          <th>597</th>
          <td>598</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>206</td>
          <td>27573</td>
          <td>27573</td>
          <td>3</td>
          <td>3</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>206</td>
          <td>413</td>
          <td>3</td>
          <td>3</td>
          <td>3</td>
          <td>3</td>
          <td>27573</td>
          <td>27573</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27573</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155829</td>
        </tr>
        <tr>
          <th>598</th>
          <td>599</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>207</td>
          <td>27703</td>
          <td>27703</td>
          <td>4</td>
          <td>4</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>207</td>
          <td>415</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>27703</td>
          <td>27703</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27703</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155959</td>
        </tr>
        <tr>
          <th>599</th>
          <td>600</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>208</td>
          <td>27832</td>
          <td>27832</td>
          <td>2</td>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>208</td>
          <td>417</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>27832</td>
          <td>27832</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27832</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>156088</td>
        </tr>
      </tbody>
    </table>
    <p>469 rows × 40 columns</p>
    </div>
    </div>
    <br />
    <br />

.. GENERATED FROM PYTHON SOURCE LINES 104-116

:py:mod:`.mkh5mne` raw data utilities
=====================================

These utility functions access mkh5 information embedded in the RawMkH5 object.

:py:meth:`.find_mkh5_events`
----------------------------

This is a replacement for :py:meth:`mne.find_events` that creates
the 3 column array of [sample, 0, event] used for native mne.Raw epoching and
plotting without doing wrong things like converting negative event
codes to positive.

.. GENERATED FROM PYTHON SOURCE LINES 116-126

.. code-block:: default

    print(garv_bads, garv_bads.description)
    p3_events = mkh5mne.find_mkh5_events(mne_raw, "ms1500")
    p3_events

    # :py:meth:`.get_find_mkh5_events`
    # ----------------------------
    #
    # This extracts the embedded epochs table from the RawMkh5.
    metadata = mkh5mne.get_epochs_metadata(mne_raw, "ms1500")
    metadata




.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    <Annotations | 58 segments: BAD_garv_32 (33), BAD_garv_48 (25)> ['BAD_garv_48' 'BAD_garv_48' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_48'
     'BAD_garv_48' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_32'
     'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_32'
     'BAD_garv_48' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32'
     'BAD_garv_48' 'BAD_garv_48' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_48'
     'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32'
     'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32'
     'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32'
     'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_48'
     'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_32' 'BAD_garv_48'
     'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_48'
     'BAD_garv_32' 'BAD_garv_48' 'BAD_garv_48']


.. raw:: html

    <div class="output_subarea output_html rendered_html output_result">
    <div>
    <style scoped>
        .dataframe tbody tr th:only-of-type {
            vertical-align: middle;
        }

        .dataframe tbody tr th {
            vertical-align: top;
        }

        .dataframe thead th {
            text-align: right;
        }
    </style>
    <table border="1" class="dataframe">
      <thead>
        <tr style="text-align: right;">
          <th></th>
          <th>epoch_id</th>
          <th>data_group</th>
          <th>dblock_path</th>
          <th>dblock_tick_idx</th>
          <th>dblock_ticks</th>
          <th>crw_ticks</th>
          <th>raw_evcodes</th>
          <th>log_evcodes</th>
          <th>log_ccodes</th>
          <th>log_flags</th>
          <th>epoch_match_tick_delta</th>
          <th>epoch_ticks</th>
          <th>dblock_srate</th>
          <th>match_group</th>
          <th>idx</th>
          <th>dlim</th>
          <th>anchor_str</th>
          <th>match_str</th>
          <th>anchor_code</th>
          <th>match_code</th>
          <th>anchor_tick</th>
          <th>match_tick</th>
          <th>anchor_tick_delta</th>
          <th>is_anchor</th>
          <th>regexp</th>
          <th>ccode</th>
          <th>instrument</th>
          <th>bin</th>
          <th>tone</th>
          <th>stim</th>
          <th>accuracy</th>
          <th>acc_type</th>
          <th>match_time</th>
          <th>anchor_time</th>
          <th>anchor_time_delta</th>
          <th>diti_t_0</th>
          <th>diti_hop</th>
          <th>diti_len</th>
          <th>mne_dblock_path_idx</th>
          <th>mne_raw_tick</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <th>27</th>
          <td>27</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>0</td>
          <td>943</td>
          <td>943</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>0</td>
          <td>1</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>943</td>
          <td>943</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>943</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>943</td>
        </tr>
        <tr>
          <th>28</th>
          <td>28</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>1</td>
          <td>1212</td>
          <td>1212</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>1</td>
          <td>4</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>1212</td>
          <td>1212</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1212</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1212</td>
        </tr>
        <tr>
          <th>0</th>
          <td>0</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>2</td>
          <td>1468</td>
          <td>1468</td>
          <td>11</td>
          <td>11</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>2</td>
          <td>7</td>
          <td>11</td>
          <td>11</td>
          <td>11</td>
          <td>11</td>
          <td>1468</td>
          <td>1468</td>
          <td>0</td>
          <td>True</td>
          <td>(#11) 1040</td>
          <td>1</td>
          <td>eeg</td>
          <td>3</td>
          <td>hi</td>
          <td>target</td>
          <td>correct</td>
          <td>hit</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1468</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1468</td>
        </tr>
        <tr>
          <th>29</th>
          <td>29</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>4</td>
          <td>1814</td>
          <td>1814</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>4</td>
          <td>15</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>1814</td>
          <td>1814</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>1814</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>1814</td>
        </tr>
        <tr>
          <th>30</th>
          <td>30</td>
          <td>sub000</td>
          <td>sub000/dblock_0</td>
          <td>5</td>
          <td>2066</td>
          <td>2066</td>
          <td>10</td>
          <td>10</td>
          <td>1</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>5</td>
          <td>18</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>10</td>
          <td>2066</td>
          <td>2066</td>
          <td>0</td>
          <td>True</td>
          <td>(#10) (?!1040)</td>
          <td>1</td>
          <td>eeg</td>
          <td>4</td>
          <td>lo</td>
          <td>standard</td>
          <td>correct</td>
          <td>cr</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>2066</td>
          <td>-187</td>
          <td>375</td>
          <td>0</td>
          <td>2066</td>
        </tr>
        <tr>
          <th>...</th>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
          <td>...</td>
        </tr>
        <tr>
          <th>595</th>
          <td>596</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>204</td>
          <td>27315</td>
          <td>27315</td>
          <td>4</td>
          <td>4</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>204</td>
          <td>409</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>27315</td>
          <td>27315</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27315</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155571</td>
        </tr>
        <tr>
          <th>596</th>
          <td>597</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>205</td>
          <td>27444</td>
          <td>27444</td>
          <td>2</td>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>205</td>
          <td>411</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>27444</td>
          <td>27444</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27444</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155700</td>
        </tr>
        <tr>
          <th>597</th>
          <td>598</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>206</td>
          <td>27573</td>
          <td>27573</td>
          <td>3</td>
          <td>3</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>206</td>
          <td>413</td>
          <td>3</td>
          <td>3</td>
          <td>3</td>
          <td>3</td>
          <td>27573</td>
          <td>27573</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27573</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155829</td>
        </tr>
        <tr>
          <th>598</th>
          <td>599</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>207</td>
          <td>27703</td>
          <td>27703</td>
          <td>4</td>
          <td>4</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>207</td>
          <td>415</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>4</td>
          <td>27703</td>
          <td>27703</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27703</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>155959</td>
        </tr>
        <tr>
          <th>599</th>
          <td>600</td>
          <td>sub000</td>
          <td>sub000/dblock_4</td>
          <td>208</td>
          <td>27832</td>
          <td>27832</td>
          <td>2</td>
          <td>2</td>
          <td>0</td>
          <td>0</td>
          <td>-187</td>
          <td>375</td>
          <td>250.0</td>
          <td>1</td>
          <td>208</td>
          <td>417</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
          <td>27832</td>
          <td>27832</td>
          <td>0</td>
          <td>True</td>
          <td>(#\d+)</td>
          <td>0</td>
          <td>cal</td>
          <td>0</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>cal</td>
          <td>0</td>
          <td>0</td>
          <td>0</td>
          <td>27832</td>
          <td>-187</td>
          <td>375</td>
          <td>4</td>
          <td>156088</td>
        </tr>
      </tbody>
    </table>
    <p>600 rows × 40 columns</p>
    </div>
    </div>
    <br />
    <br />


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  21.051 seconds)


.. _sphx_glr_download_examples_gallery_mkh5mne_how_it_works.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: how_it_works.py <how_it_works.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: how_it_works.ipynb <how_it_works.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
